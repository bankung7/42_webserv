###### config file ######
## https://www.plesk.com/blog/various/nginx-configuration-guide/

# Choose port and host for each server
# setup the server_name or not
    #### https://statuslist.app/nginx/server_name/
# first server host:port will be the default for the host:port, that will answer to all request that not belong to other server
# setup default error page
# limit client body size
# setup route with one or multiple rule/config (cannot use regexp)
## define a list of accepted http method for the route
## define a http redirection
## define a directory or file where the file should be searched. if url /kapouet is rooted to /tmp/www. if url /kapouet/pouic/toto/pouet is rooted to /tmp/www/pouic/toto/pouet
## turn on or off directory listing ???
## set default file to answer if the request is a directory
## execute CGI based on certain file extension
## make it work with POST and GET method
## make the route able to accept uploaded files and configure where ther should be saved
## work with 1 CGI

## server 1
server {

    # listening host and port
    # [ip:port] or [port]
    listen 127.0.0.1:8080;
    listen 8080;

    # server name
    server_name server1;

    # root [location]
    root /sites

    # index [page]
    index index.html

    # allowed method [method1, ..., methodn]
    allowedMethod GET,POST,DELETE;

    # error page [code page]
    error_page 404 404.html

    # client site
    maxClientBodySize 1000000

    # location list, searchin from here to bottom match the latest one exclude "/", this case
    location / {
        root /sites;
        index   index.html;
    }

    # location for image file type
    location /images {
        root /sites/image;
    }

    # for redirection
    location /search {
        return https://www.google.co.th
    }

    # for CGI
    location *.php {
        allowedMethod GET,POST
        cgi_pass /usr/bin/php-cgi
    }

}

## server 2
server {
    listen 8081;
    server_name server2;
    allowedMethod GET;

    # autoindex
    autoindex on;
}
